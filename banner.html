<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Akshar Hanumandham | Random Ad Banner</title>
<meta http-equiv="Cache-Control" content="max-age=60">
<style>
  body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: #000;
  }

  #banner-slot {
    position: relative;
    width: 100%;
    max-height: 250px;
    overflow: hidden;
  }

  #banner-slot img {
    width: 100%;
    max-height: 250px;
    display: block;
    opacity: 0;
    transition: opacity 1s ease-in-out;
  }

  #banner-slot img.active {
    opacity: 1;
  }

  .tag {
    position: absolute;
    top: 4px;
    right: 4px;
    background: rgba(0,0,0,0.6);
    color: white;
    font-size: 12px;
    padding: 3px 6px;
    border-radius: 4px;
    text-decoration: none;
  }

  .wrapper {
    position: relative;
  }
</style>
</head>
<body>

<div id="banner-slot">
  <p style="color:white;text-align:center;padding:100px 0;">Loading banner...</p>
</div>

<!-- âœ… Correct JS path + cache-buster -->
<script src="data/banners_f.js?v=1.2"></script>

<script>
(function() {
  const slot = document.getElementById('banner-slot');
  const REFRESH_INTERVAL = 20000; // 20 seconds
  let lastIndex = -1;

  function getValidBanners() {
    const arr = window.banners || [];
    return arr.filter(b => {
      const exp = new Date(b.expiry);
      return exp.toString() !== "Invalid Date" && exp.getTime() > Date.now();
    });
  }

  function loadRandomBanner() {
    const validBanners = getValidBanners();
    if (!validBanners.length) {
      slot.innerHTML = "<p style='color:white;text-align:center;'>No active banners (check data/banners.js)</p>";
      return;
    }

    // Random index, avoid repeating same banner consecutively
    let index;
    do {
      index = Math.floor(Math.random() * validBanners.length);
    } while (index === lastIndex && validBanners.length > 1);
    lastIndex = index;

    const banner = validBanners[index];

    slot.innerHTML = `
      <div class="wrapper">
        <a href="${banner.link}" target="_blank" rel="noopener">
          <img src="${banner.img}?t=${Date.now()}" alt="Banner">
        </a>
        <a href="https://aksharhanumandham.in/advertise.html" class="tag" target="_blank">Sponsored Ad</a>
      </div>
    `;

    const img = slot.querySelector("img");
    img.onload = () => img.classList.add("active");
  }

  window.addEventListener("load", function() {
    console.log("Loaded banners:", window.banners);
    loadRandomBanner();
    setInterval(loadRandomBanner, REFRESH_INTERVAL);
  });
})();
</script>
</body>
</html>
